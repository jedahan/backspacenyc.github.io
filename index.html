<!doctype html>
<html>
  <head>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />

    <style>
      html {
        height: 90%;
        max-height: 800px;
        background-color: lightyellow;
      }

      body {
        height: 100%;
        display: grid;
        grid-gap: 1em;
        grid-template-columns: 2fr;
        width: 1280px;
        color: white;
        font-family: 'Open Sans', sans-serif;
        margin-left: auto;
        margin-right: auto;
      }


      h1, h2, h3, h4, h5 {
        font-family: 'Megrim', cursive;
        text-align: center;
      }

      @font-face {
        font-family: "Open Sans";
        src: url("fonts/Open_Sans/OpenSans-Regular.ttf");
      }

      @font-face {
        font-family: "Megrim";
        src: url("fonts/Megrim/Megrim.ttf");
      }

      #week {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-column: 1/2;
        grid-gap: 1em;
        background-color: salmon;
        height: 100%;
      }

      .day {
        background-color: steelblue;
      }

      #blocks {
        grid-column: 2/2;
        background-color: lightgreen;
      }

      .block {
        margin: 1em;
        padding: 1em;
        background-color: lightsalmon;
      }
    </style>

    <script>
      var counter=0;
      function dragstart_handler(ev) {
        ev.target.dataset.dragging = 'true';
        ev.dataTransfer.setData("text/plain", ev.target.textContent);
        ev.dataTransfer.dropEffect = "copy";
      }

      function dragover_handler(ev) {
        ev.preventDefault();
        ev.dataTransfer.dropEffect = "copy"
      }

      function click_to_delete_handler(ev) {
        ev.preventDefault();
        ev.target.parentNode.removeChild(ev.target);
      }

      function click_to_edit_or_drag(ev) {
        if (ev.target.dataset.dragging == 'true') {
            return;
        }
        ev.target.setAttribute('draggable', 'false');
        ev.target.setAttribute('contenteditable', 'true');
        ev.preventDefault();
      }

      function blur_handler(ev) {
        ev.target.setAttribute('draggable', 'true');
        ev.target.setAttribute('contenteditable', 'false');
      }

      function dragend_handler(ev) {
        ev.target.dataset.dragging = 'false';
        ev.preventDefault();
      }

      function drop_handler(ev) {
        var text = ev.dataTransfer.getData("text");
        var textNode = document.createTextNode(text);
        var blockNode = document.createElement('section');
        blockNode.appendChild(textNode);
        blockNode.className = 'block';
        blockNode.id = counter++;
        blockNode.style.background = 'salmon'; // alberrrrs!
        blockNode.addEventListener('click', click_to_delete_handler, true);
        ev.target.appendChild(blockNode);
        ev.preventDefault();
      }

      window.onload = function() {
        let days = Array.from(document.getElementsByClassName('day'));
        days.forEach(function(day) {
          day.addEventListener('dragover', dragover_handler, true);
          day.addEventListener('drop', drop_handler, true);
        });

        let blocks = Array.from(document.getElementsByClassName('block'));
        blocks.forEach(function(block) {
          block.addEventListener('dragstart', dragstart_handler, true);
          block.addEventListener('click', click_to_edit_or_drag, true);
          block.addEventListener('blur', blur_handler, true);
          block.addEventListener('dragend', dragend_handler, true);
        });
      }
    </script>
  </head>

  <body>
    <div id=week>
      <section class=day id=monday>
        <h1>monday</h1>
      </section>
      <section class=day id=tuesday>
        <h1>tuesday</h1>
      </section>
      <section class=day id=wednesday>
        <h1>wednesday</h1>
      </section>
      <section class=day id=thursday>
        <h1>thursday</h1>
      </section>
      <section class=day id=friday>
        <h1>friday</h1>
      </section>
    </div>

    <div id=blocks>
      <section contenteditable=true draggable=true class=block>study japanese</section>
      <section contenteditable=true draggable=true class=block>click me!</section>
      <section contenteditable=true draggable=true class=block>nsf/mozilla</section>
      <section contenteditable=true draggable=true class=block>drag me!</section>
      <section contenteditable=true draggable=true class=block>workout</section>
      <section contenteditable=true draggable=true class=block>smalldata</section>
      <section contenteditable=true draggable=true class=block>research</section>
      <section contenteditable=true draggable=true class=block>free time</section>
    </div>
  </body>
</html>
